<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FRC Multi-Team Scouting App</title>
<style>
  /* 基礎樣式設定 */
  body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Fira Sans", "Droid Sans", "Helvetica Neue", sans-serif;
    margin: 0;
    background-color: #f0f0f7;
    color: #333;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  
  /* 主要分頁標籤樣式 */
  .main-tabs {
    display: flex;
    justify-content: space-around;
    background-color: #333;
    color: white;
    padding: 10px 0;
    position: sticky;
    top: 0;
    z-index: 100;
  }
  .main-tab {
    flex: 1;
    padding: 10px 0;
    cursor: pointer;
    text-align: center;
    border-bottom: 3px solid transparent;
    transition: border-bottom-color 0.3s ease;
  }
  .main-tab.active {
    border-bottom-color: #4CAF50;
  }

  /* 隊伍容器與分頁顯示控制 */
  .team-container, .data-container {
    display: none;
    padding: 20px;
  }
  .team-container.active, .data-container.active {
    display: block;
  }
  
  /* 頁面標題樣式 */
  .header {
    font-size: 28px;
    font-weight: bold;
    margin-bottom: 30px;
    text-align: center;
    color: #444;
  }

  /* 輸入框樣式 */
  .input-group {
    margin-bottom: 20px;
    text-align: left;
  }
  .input-group label {
    display: block;
    margin-bottom: 5px;
    font-size: 16px;
    color: #555;
    font-weight: 500;
  }
  .input-group input, .input-group select, .input-group textarea {
    width: 100%;
    padding: 12px;
    border-radius: 10px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    font-size: 16px;
    background-color: white;
    transition: border-color 0.3s ease;
  }
  .input-group input:focus, .input-group select:focus, .input-group textarea:focus {
      border-color: #4CAF50;
      outline: none;
  }
  .two-col-group {
    display: flex;
    justify-content: space-between;
    gap: 10px;
  }
  .two-col-group > div {
    flex: 1;
  }

  /* 導航按鈕樣式 */
  .action-button {
    flex: 1;
    padding: 15px;
    font-size: 18px;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: background-color 0.3s ease, transform 0.1s ease;
  }
  .action-button {
      background-color: #007bff;
      color: white;
      width: 100%;
      margin-top: 20px;
  }
  .action-button:hover {
      opacity: 0.9;
  }
  .action-button:active {
      transform: scale(0.98);
  }

  /* 計分項目樣式 */
  .check-row {
    display: flex;
    align-items: center;
    justify-content: flex-start;
    margin-bottom: 20px;
  }
  .check-row input[type="checkbox"] {
    margin-right: 10px;
    transform: scale(1.5);
  }
  /* 針對 Coopertition 勾選框特別放大 */
  .coopertition-checkbox {
      transform: scale(2.0); /* 放大兩倍 */
  }

  .score-item {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 15px;
  }
  .item-label {
    font-size: 18px;
    text-align: left;
    flex-grow: 1;
  }
  .score-controls {
    display: flex;
    align-items: center;
  }
  .score-controls button {
    width: 50px;
    height: 50px;
    font-size: 20px;
    border: none;
    border-radius: 12px;
    margin: 0 5px;
    background-color: #e0e0e0;
    color: #555;
    cursor: pointer;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    transition: background-color 0.3s ease, transform 0.1s ease;
  }
  .score-controls button.plus {
    background-color: #6a8dff;
    color: white;
  }
  .score-controls button.minus {
    background-color: #f0f0f0;
    color: #555;
  }
  .score-controls button:active {
      transform: scale(0.9);
  }
  .score-count {
    font-size: 24px;
    font-weight: bold;
    min-width: 40px;
    text-align: center;
  }
  
  /* 總結區塊樣式 */
  .result-section {
    background-color: white;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 4px 8px rgba(0,0,0,0.05);
  }
  .result-header {
    font-size: 22px;
    font-weight: bold;
    margin-bottom: 20px;
    color: #555;
    border-bottom: 2px solid #eee;
    padding-bottom: 10px;
  }

  /* 內部頁面分頁樣式 */
  .page-tabs {
    display: flex;
    justify-content: space-around;
    background-color: #e9e9e9;
    border-radius: 10px;
    margin-bottom: 20px;
  }
  .page-tab {
    flex: 1;
    padding: 10px 0;
    cursor: pointer;
    text-align: center;
    border-bottom: 2px solid transparent;
    font-weight: 500;
    transition: border-bottom-color 0.3s ease;
  }
  .page-tab.active {
    border-bottom-color: #4CAF50;
  }
  .page-content {
    display: none;
  }
  .page-content.active {
    display: block;
  }
  
  /* 檔案庫樣式 */
  #data-view-container {
    padding: 20px;
  }
  #data-list {
    display: flex;
    flex-direction: column;
    gap: 15px;
  }
  .data-item {
    background-color: white;
    padding: 15px;
    border-radius: 10px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    display: flex;
    justify-content: space-between;
    align-items: center;
    cursor: pointer;
  }
  .data-item:hover {
    background-color: #f5f5f5;
  }
  .data-info {
    font-weight: bold;
    font-size: 16px;
  }
  .data-actions button {
    background-color: #dc3545;
    color: white;
    border: none;
    padding: 8px 12px;
    border-radius: 8px;
    cursor: pointer;
    margin-left: 10px;
  }
  .data-actions button:hover {
      background-color: #c82333;
  }
  
  /* 彈出視窗 (Modal) 樣式 */
  .modal {
    display: none;
    position: fixed;
    z-index: 200;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0,0,0,0.4);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    justify-content: center;
    align-items: center;
  }
  .modal-content {
    background-color: #fefefe;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    width: 90%;
    max-width: 600px;
    position: relative; /* 確保內容相對於此定位 */
    display: flex;
    flex-direction: column;
  }
  /* 新增彈窗標題容器樣式 */
  .modal-header-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      border-bottom: 1px solid #eee;
      padding-bottom: 10px;
  }
  .modal-title {
      font-size: 24px;
      font-weight: bold;
      margin: 0;
  }
  .close-button {
      color: #aaa;
      font-size: 30px;
      font-weight: bold;
      cursor: pointer;
      line-height: 1; /* 確保垂直對齊 */
  }
  .close-button:hover,
  .close-button:focus {
    color: #000;
    text-decoration: none;
    cursor: pointer;
  }
  .modal-section {
    margin-bottom: 20px;
  }
  .modal-section-header {
    font-size: 20px;
    font-weight: bold;
    margin-bottom: 10px;
    border-bottom: 1px solid #ccc;
    padding-bottom: 5px;
  }
  .modal-data-row {
    display: flex;
    justify-content: space-between;
    padding: 5px 0;
  }
  .modal-label {
    font-weight: bold;
  }
</style>
</head>
<body>

  <!-- 頂部主要分頁標籤 -->
  <div class="main-tabs">
    <div id="tab-team1" class="main-tab active" onclick="switchMainTab('team-container-1', this)">Team 1</div>
    <div id="tab-team2" class="main-tab" onclick="switchMainTab('team-container-2', this)">Team 2</div>
    <div id="tab-team3" class="main-tab" onclick="switchMainTab('team-container-3', this)">Team 3</div>
    <div id="tab-data" class="main-tab" onclick="switchMainTab('data-container', this)">檔案庫</div>
  </div>

  <!-- 隊伍 1 的容器 -->
  <div id="team-container-1" class="team-container active">
    <!-- 頁面分頁 -->
    <div class="page-tabs">
      <div id="tab-page-match-info-1" class="page-tab active" onclick="goToPage(1, 'match-info')">比賽資訊</div>
      <div id="tab-page-auto-1" class="page-tab" onclick="goToPage(1, 'auto')">Auto</div>
      <div id="tab-page-teleop-1" class="page-tab" onclick="goToPage(1, 'teleop')">Teleop</div>
      <div id="tab-page-endgame-1" class="page-tab" onclick="goToPage(1, 'endgame')">Endgame</div>
    </div>
    <!-- 頁面內容 -->
    <div id="page-match-info-1" class="page-content active">
      <div class="header">比賽資訊 - Team 1</div>
      <div class="input-group"><label for="scout-name-1">你的名字</label><input type="text" id="scout-name-1" oninput="updateCurrentScout()"></div>
      <div class="input-group"><label for="team-number-1">隊伍編號</label><input type="number" id="team-number-1" oninput="updateCurrentScout()"></div>
      <div class="two-col-group">
        <div class="input-group"><label for="match-type-1">比賽類型</label><select id="match-type-1" onchange="updateCurrentScout()"><option value="practice">Practice</option><option value="qualification">Qualification</option><option value="final">Final</option></select></div>
        <div class="input-group"><label for="match-number-1">比賽編號</label><input type="number" id="match-number-1" oninput="updateCurrentScout()"></div>
      </div>
    </div>
    <div id="page-auto-1" class="page-content">
      <div class="header">Auto - Team 1</div>
      <div class="check-row"><input type="checkbox" id="auto_leave-starting-line-1" onchange="updateCurrentScout()"><label for="auto_leave-starting-line-1">Leave Starting Line</label></div>
      <div class="score-item"><span class="item-label">Coral L1</span><div class="score-controls"><button class="minus" onclick="changeScore(1, 'auto_coral-l1', -1)">-</button><span id="auto_coral-l1-score-1" class="score-count">0</span><button class="plus" onclick="changeScore(1, 'auto_coral-l1', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L2</span><div class="score-controls"><button class="minus" onclick="changeScore(1, 'auto_coral-l2', -1)">-</button><span id="auto_coral-l2-score-1" class="score-count">0</span><button class="plus" onclick="changeScore(1, 'auto_coral-l2', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L3</span><div class="score-controls"><button class="minus" onclick="changeScore(1, 'auto_coral-l3', -1)">-</button><span id="auto_coral-l3-score-1" class="score-count">0</span><button class="plus" onclick="changeScore(1, 'auto_coral-l3', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L4</span><div class="score-controls"><button class="minus" onclick="changeScore(1, 'auto_coral-l4', -1)">-</button><span id="auto_coral-l4-score-1" class="score-count">0</span><button class="plus" onclick="changeScore(1, 'auto_coral-l4', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Processor</span><div class="score-controls"><button class="minus" onclick="changeScore(1, 'auto_processor', -1)">-</button><span id="auto_processor-score-1" class="score-count">0</span><button class="plus" onclick="changeScore(1, 'auto_processor', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Net</span><div class="score-controls"><button class="minus" onclick="changeScore(1, 'auto_net', -1)">-</button><span id="auto_net-score-1" class="score-count">0</span><button class="plus" onclick="changeScore(1, 'auto_net', 1)">+</button></div></div>
    </div>
    <div id="page-teleop-1" class="page-content">
      <div class="header">Teleop - Team 1</div>
      <div class="score-item"><span class="item-label">Coral L1</span><div class="score-controls"><button class="minus" onclick="changeScore(1, 'teleop_coral-l1', -1)">-</button><span id="teleop_coral-l1-score-1" class="score-count">0</span><button class="plus" onclick="changeScore(1, 'teleop_coral-l1', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L2</span><div class="score-controls"><button class="minus" onclick="changeScore(1, 'teleop_coral-l2', -1)">-</button><span id="teleop_coral-l2-score-1" class="score-count">0</span><button class="plus" onclick="changeScore(1, 'teleop_coral-l2', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L3</span><div class="score-controls"><button class="minus" onclick="changeScore(1, 'teleop_coral-l3', -1)">-</button><span id="teleop_coral-l3-score-1" class="score-count">0</span><button class="plus" onclick="changeScore(1, 'teleop_coral-l3', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L4</span><div class="score-controls"><button class="minus" onclick="changeScore(1, 'teleop_coral-l4', -1)">-</button><span id="teleop_coral-l4-score-1" class="score-count">0</span><button class="plus" onclick="changeScore(1, 'teleop_coral-l4', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Processor</span><div class="score-controls"><button class="minus" onclick="changeScore(1, 'teleop_processor', -1)">-</button><span id="teleop_processor-score-1" class="score-count">0</span><button class="plus" onclick="changeScore(1, 'teleop_processor', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Net</span><div class="score-controls"><button class="minus" onclick="changeScore(1, 'teleop_net', -1)">-</button><span id="teleop_net-score-1" class="score-count">0</span><button class="plus" onclick="changeScore(1, 'teleop_net', 1)">+</button></div></div>
      <div class="input-group"><label for="teleop_intake-coral-from-1">Intake Coral From</label><select id="teleop_intake-coral-from-1" onchange="updateCurrentScout()"><option value="coral station">Coral Station</option><option value="floor">Floor</option><option value="both">Both</option><option value="did not attempt">Did Not Attempt</option></select></div>
      <div class="check-row"><input type="checkbox" id="teleop_remove-algae-1" onchange="updateCurrentScout()"><label for="teleop_remove-algae-1">Remove Algae from Reef</label></div>
    </div>
    <div id="page-endgame-1" class="page-content">
      <div class="header">Endgame - Team 1</div>
      <div class="input-group"><label for="endgame_barge-status-1">Barge Status</label><select id="endgame_barge-status-1" onchange="updateCurrentScout()"><option value="deep">Deep</option><option value="shallow">Shallow</option><option value="fd">FD</option><option value="fs">FS</option><option value="parked">Parked</option><option value="did not attempt">Did Not Attempt</option></select></div>
      <div class="result-section">
        <div class="result-header">Result</div>
        <div class="input-group check-row"><label for="endgame_coopertition-1">Coopertition</label><input type="checkbox" id="endgame_coopertition-1" class="coopertition-checkbox" onchange="updateCurrentScout()"></div>
        <div class="input-group"><label for="endgame_total-score-1">Total Score</label><input type="number" id="endgame_total-score-1" oninput="updateCurrentScout()"></div>
        <div class="input-group"><label for="endgame_ranking-points-1">Ranking Points</label><input type="number" id="endgame_ranking-points-1" oninput="updateCurrentScout()"></div>
        <div class="input-group"><label for="endgame_role-1">Role</label><select id="endgame_role-1" onchange="updateCurrentScout()"><option value="coral">Coral</option><option value="algae">Algae</option><option value="c&a">C&A</option><option value="defense">Defense</option><option value="do nothing">Do Nothing</option></select></div>
        <div class="input-group"><label for="endgame_driver-skill-1">Driver Skill</label><select id="endgame_driver-skill-1" onchange="updateCurrentScout()"><option value="great">Great</option><option value="good">Good</option><option value="bad">Bad</option></select></div>
        <div class="input-group"><label for="endgame_match-result-1">Match Result</label><select id="endgame_match-result-1" onchange="updateCurrentScout()"><option value="win">Win</option><option value="lose">Lose</option><option value="tie">Tie</option></select></div>
      </div>
      <div class="input-group"><label for="endgame_comments-1">Comments</label><textarea id="endgame_comments-1" rows="4" oninput="updateCurrentScout()"></textarea></div>
      <button class="action-button" onclick="saveScoutData(1)">完成並儲存</button>
    </div>
  </div>

  <!-- 隊伍 2 的容器 (與 Team 1 相同結構) -->
  <div id="team-container-2" class="team-container">
    <div class="page-tabs">
      <div id="tab-page-match-info-2" class="page-tab active" onclick="goToPage(2, 'match-info')">比賽資訊</div>
      <div id="tab-page-auto-2" class="page-tab" onclick="goToPage(2, 'auto')">Auto</div>
      <div id="tab-page-teleop-2" class="page-tab" onclick="goToPage(2, 'teleop')">Teleop</div>
      <div id="tab-page-endgame-2" class="page-tab" onclick="goToPage(2, 'endgame')">Endgame</div>
    </div>
    <div id="page-match-info-2" class="page-content active">
      <div class="header">比賽資訊 - Team 2</div>
      <div class="input-group"><label for="scout-name-2">你的名字</label><input type="text" id="scout-name-2" oninput="updateCurrentScout()"></div>
      <div class="input-group"><label for="team-number-2">隊伍編號</label><input type="number" id="team-number-2" oninput="updateCurrentScout()"></div>
      <div class="two-col-group">
        <div class="input-group"><label for="match-type-2">比賽類型</label><select id="match-type-2" onchange="updateCurrentScout()"><option value="practice">Practice</option><option value="qualification">Qualification</option><option value="final">Final</option></select></div>
        <div class="input-group"><label for="match-number-2">比賽編號</label><input type="number" id="match-number-2" oninput="updateCurrentScout()"></div>
      </div>
    </div>
    <div id="page-auto-2" class="page-content">
      <div class="header">Auto - Team 2</div>
      <div class="check-row"><input type="checkbox" id="auto_leave-starting-line-2" onchange="updateCurrentScout()"><label for="auto_leave-starting-line-2">Leave Starting Line</label></div>
      <div class="score-item"><span class="item-label">Coral L1</span><div class="score-controls"><button class="minus" onclick="changeScore(2, 'auto_coral-l1', -1)">-</button><span id="auto_coral-l1-score-2" class="score-count">0</span><button class="plus" onclick="changeScore(2, 'auto_coral-l1', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L2</span><div class="score-controls"><button class="minus" onclick="changeScore(2, 'auto_coral-l2', -1)">-</button><span id="auto_coral-l2-score-2" class="score-count">0</span><button class="plus" onclick="changeScore(2, 'auto_coral-l2', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L3</span><div class="score-controls"><button class="minus" onclick="changeScore(2, 'auto_coral-l3', -1)">-</button><span id="auto_coral-l3-score-2" class="score-count">0</span><button class="plus" onclick="changeScore(2, 'auto_coral-l3', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L4</span><div class="score-controls"><button class="minus" onclick="changeScore(2, 'auto_coral-l4', -1)">-</button><span id="auto_coral-l4-score-2" class="score-count">0</span><button class="plus" onclick="changeScore(2, 'auto_coral-l4', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Processor</span><div class="score-controls"><button class="minus" onclick="changeScore(2, 'auto_processor', -1)">-</button><span id="auto_processor-score-2" class="score-count">0</span><button class="plus" onclick="changeScore(2, 'auto_processor', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Net</span><div class="score-controls"><button class="minus" onclick="changeScore(2, 'auto_net', -1)">-</button><span id="auto_net-score-2" class="score-count">0</span><button class="plus" onclick="changeScore(2, 'auto_net', 1)">+</button></div></div>
    </div>
    <div id="page-teleop-2" class="page-content">
      <div class="header">Teleop - Team 2</div>
      <div class="score-item"><span class="item-label">Coral L1</span><div class="score-controls"><button class="minus" onclick="changeScore(2, 'teleop_coral-l1', -1)">-</button><span id="teleop_coral-l1-score-2" class="score-count">0</span><button class="plus" onclick="changeScore(2, 'teleop_coral-l1', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L2</span><div class="score-controls"><button class="minus" onclick="changeScore(2, 'teleop_coral-l2', -1)">-</button><span id="teleop_coral-l2-score-2" class="score-count">0</span><button class="plus" onclick="changeScore(2, 'teleop_coral-l2', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L3</span><div class="score-controls"><button class="minus" onclick="changeScore(2, 'teleop_coral-l3', -1)">-</button><span id="teleop_coral-l3-score-2" class="score-count">0</span><button class="plus" onclick="changeScore(2, 'teleop_coral-l3', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L4</span><div class="score-controls"><button class="minus" onclick="changeScore(2, 'teleop_coral-l4', -1)">-</button><span id="teleop_coral-l4-score-2" class="score-count">0</span><button class="plus" onclick="changeScore(2, 'teleop_coral-l4', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Processor</span><div class="score-controls"><button class="minus" onclick="changeScore(2, 'teleop_processor', -1)">-</button><span id="teleop_processor-score-2" class="score-count">0</span><button class="plus" onclick="changeScore(2, 'teleop_processor', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Net</span><div class="score-controls"><button class="minus" onclick="changeScore(2, 'teleop_net', -1)">-</button><span id="teleop_net-score-2" class="score-count">0</span><button class="plus" onclick="changeScore(2, 'teleop_net', 1)">+</button></div></div>
      <div class="input-group"><label for="teleop_intake-coral-from-2">Intake Coral From</label><select id="teleop_intake-coral-from-2" onchange="updateCurrentScout()"><option value="coral station">Coral Station</option><option value="floor">Floor</option><option value="both">Both</option><option value="did not attempt">Did Not Attempt</option></select></div>
      <div class="check-row"><input type="checkbox" id="teleop_remove-algae-2" onchange="updateCurrentScout()"><label for="teleop_remove-algae-2">Remove Algae from Reef</label></div>
    </div>
    <div id="page-endgame-2" class="page-content">
      <div class="header">Endgame - Team 2</div>
      <div class="input-group"><label for="endgame_barge-status-2">Barge Status</label><select id="endgame_barge-status-2" onchange="updateCurrentScout()"><option value="deep">Deep</option><option value="shallow">Shallow</option><option value="fd">FD</option><option value="fs">FS</option><option value="parked">Parked</option><option value="did not attempt">Did Not Attempt</option></select></div>
      <div class="result-section">
        <div class="result-header">Result</div>
        <div class="input-group check-row"><label for="endgame_coopertition-2">Coopertition</label><input type="checkbox" id="endgame_coopertition-2" class="coopertition-checkbox" onchange="updateCurrentScout()"></div>
        <div class="input-group"><label for="endgame_total-score-2">Total Score</label><input type="number" id="endgame_total-score-2" oninput="updateCurrentScout()"></div>
        <div class="input-group"><label for="endgame_ranking-points-2">Ranking Points</label><input type="number" id="endgame_ranking-points-2" oninput="updateCurrentScout()"></div>
        <div class="input-group"><label for="endgame_role-2">Role</label><select id="endgame_role-2" onchange="updateCurrentScout()"><option value="coral">Coral</option><option value="algae">Algae</option><option value="c&a">C&A</option><option value="defense">Defense</option><option value="do nothing">Do Nothing</option></select></div>
        <div class="input-group"><label for="endgame_driver-skill-2">Driver Skill</label><select id="endgame_driver-skill-2" onchange="updateCurrentScout()"><option value="great">Great</option><option value="good">Good</option><option value="bad">Bad</option></select></div>
        <div class="input-group"><label for="endgame_match-result-2">Match Result</label><select id="endgame_match-result-2" onchange="updateCurrentScout()"><option value="win">Win</option><option value="lose">Lose</option><option value="tie">Tie</option></select></div>
      </div>
      <div class="input-group"><label for="endgame_comments-2">Comments</label><textarea id="endgame_comments-2" rows="4" oninput="updateCurrentScout()"></textarea></div>
      <button class="action-button" onclick="saveScoutData(2)">完成並儲存</button>
    </div>
  </div>

  <!-- 隊伍 3 的容器 (與 Team 1 相同結構) -->
  <div id="team-container-3" class="team-container">
    <div class="page-tabs">
      <div id="tab-page-match-info-3" class="page-tab active" onclick="goToPage(3, 'match-info')">比賽資訊</div>
      <div id="tab-page-auto-3" class="page-tab" onclick="goToPage(3, 'auto')">Auto</div>
      <div id="tab-page-teleop-3" class="page-tab" onclick="goToPage(3, 'teleop')">Teleop</div>
      <div id="tab-page-endgame-3" class="page-tab" onclick="goToPage(3, 'endgame')">Endgame</div>
    </div>
    <div id="page-match-info-3" class="page-content active">
      <div class="header">比賽資訊 - Team 3</div>
      <div class="input-group"><label for="scout-name-3">你的名字</label><input type="text" id="scout-name-3" oninput="updateCurrentScout()"></div>
      <div class="input-group"><label for="team-number-3">隊伍編號</label><input type="number" id="team-number-3" oninput="updateCurrentScout()"></div>
      <div class="two-col-group">
        <div class="input-group"><label for="match-type-3">比賽類型</label><select id="match-type-3" onchange="updateCurrentScout()"><option value="practice">Practice</option><option value="qualification">Qualification</option><option value="final">Final</option></select></div>
        <div class="input-group"><label for="match-number-3">比賽編號</label><input type="number" id="match-number-3" oninput="updateCurrentScout()"></div>
      </div>
    </div>
    <div id="page-auto-3" class="page-content">
      <div class="header">Auto - Team 3</div>
      <div class="check-row"><input type="checkbox" id="auto_leave-starting-line-3" onchange="updateCurrentScout()"><label for="auto_leave-starting-line-3">Leave Starting Line</label></div>
      <div class="score-item"><span class="item-label">Coral L1</span><div class="score-controls"><button class="minus" onclick="changeScore(3, 'auto_coral-l1', -1)">-</button><span id="auto_coral-l1-score-3" class="score-count">0</span><button class="plus" onclick="changeScore(3, 'auto_coral-l1', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L2</span><div class="score-controls"><button class="minus" onclick="changeScore(3, 'auto_coral-l2', -1)">-</button><span id="auto_coral-l2-score-3" class="score-count">0</span><button class="plus" onclick="changeScore(3, 'auto_coral-l2', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L3</span><div class="score-controls"><button class="minus" onclick="changeScore(3, 'auto_coral-l3', -1)">-</button><span id="auto_coral-l3-score-3" class="score-count">0</span><button class="plus" onclick="changeScore(3, 'auto_coral-l3', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L4</span><div class="score-controls"><button class="minus" onclick="changeScore(3, 'auto_coral-l4', -1)">-</button><span id="auto_coral-l4-score-3" class="score-count">0</span><button class="plus" onclick="changeScore(3, 'auto_coral-l4', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Processor</span><div class="score-controls"><button class="minus" onclick="changeScore(3, 'auto_processor', -1)">-</button><span id="auto_processor-score-3" class="score-count">0</span><button class="plus" onclick="changeScore(3, 'auto_processor', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Net</span><div class="score-controls"><button class="minus" onclick="changeScore(3, 'auto_net', -1)">-</button><span id="auto_net-score-3" class="score-count">0</span><button class="plus" onclick="changeScore(3, 'auto_net', 1)">+</button></div></div>
    </div>
    <div id="page-teleop-3" class="page-content">
      <div class="header">Teleop - Team 3</div>
      <div class="score-item"><span class="item-label">Coral L1</span><div class="score-controls"><button class="minus" onclick="changeScore(3, 'teleop_coral-l1', -1)">-</button><span id="teleop_coral-l1-score-3" class="score-count">0</span><button class="plus" onclick="changeScore(3, 'teleop_coral-l1', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L2</span><div class="score-controls"><button class="minus" onclick="changeScore(3, 'teleop_coral-l2', -1)">-</button><span id="teleop_coral-l2-score-3" class="score-count">0</span><button class="plus" onclick="changeScore(3, 'teleop_coral-l2', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L3</span><div class="score-controls"><button class="minus" onclick="changeScore(3, 'teleop_coral-l3', -1)">-</button><span id="teleop_coral-l3-score-3" class="score-count">0</span><button class="plus" onclick="changeScore(3, 'teleop_coral-l3', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Coral L4</span><div class="score-controls"><button class="minus" onclick="changeScore(3, 'teleop_coral-l4', -1)">-</button><span id="teleop_coral-l4-score-3" class="score-count">0</span><button class="plus" onclick="changeScore(3, 'teleop_coral-l4', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Processor</span><div class="score-controls"><button class="minus" onclick="changeScore(3, 'teleop_processor', -1)">-</button><span id="teleop_processor-score-3" class="score-count">0</span><button class="plus" onclick="changeScore(3, 'teleop_processor', 1)">+</button></div></div>
      <div class="score-item"><span class="item-label">Net</span><div class="score-controls"><button class="minus" onclick="changeScore(3, 'teleop_net', -1)">-</button><span id="teleop_net-score-3" class="score-count">0</span><button class="plus" onclick="changeScore(3, 'teleop_net', 1)">+</button></div></div>
      <div class="input-group"><label for="teleop_intake-coral-from-3">Intake Coral From</label><select id="teleop_intake-coral-from-3" onchange="updateCurrentScout()"><option value="coral station">Coral Station</option><option value="floor">Floor</option><option value="both">Both</option><option value="did not attempt">Did Not Attempt</option></select></div>
      <div class="check-row"><input type="checkbox" id="teleop_remove-algae-3" onchange="updateCurrentScout()"><label for="teleop_remove-algae-3">Remove Algae from Reef</label></div>
    </div>
    <div id="page-endgame-3" class="page-content">
      <div class="header">Endgame - Team 3</div>
      <div class="input-group"><label for="endgame_barge-status-3">Barge Status</label><select id="endgame_barge-status-3" onchange="updateCurrentScout()"><option value="deep">Deep</option><option value="shallow">Shallow</option><option value="fd">FD</option><option value="fs">FS</option><option value="parked">Parked</option><option value="did not attempt">Did Not Attempt</option></select></div>
      <div class="result-section">
        <div class="result-header">Result</div>
        <div class="input-group check-row"><label for="endgame_coopertition-3">Coopertition</label><input type="checkbox" id="endgame_coopertition-3" class="coopertition-checkbox" onchange="updateCurrentScout()"></div>
        <div class="input-group"><label for="endgame_total-score-3">Total Score</label><input type="number" id="endgame_total-score-3" oninput="updateCurrentScout()"></div>
        <div class="input-group"><label for="endgame_ranking-points-3">Ranking Points</label><input type="number" id="endgame_ranking-points-3" oninput="updateCurrentScout()"></div>
        <div class="input-group"><label for="endgame_role-3">Role</label><select id="endgame_role-3" onchange="updateCurrentScout()"><option value="coral">Coral</option><option value="algae">Algae</option><option value="c&a">C&A</option><option value="defense">Defense</option><option value="do nothing">Do Nothing</option></select></div>
        <div class="input-group"><label for="endgame_driver-skill-3">Driver Skill</label><select id="endgame_driver-skill-3" onchange="updateCurrentScout()"><option value="great">Great</option><option value="good">Good</option><option value="bad">Bad</option></select></div>
        <div class="input-group"><label for="endgame_match-result-3">Match Result</label><select id="endgame_match-result-3" onchange="updateCurrentScout()"><option value="win">Win</option><option value="lose">Lose</option><option value="tie">Tie</option></select></div>
      </div>
      <div class="input-group"><label for="endgame_comments-3">Comments</label><textarea id="endgame_comments-3" rows="4" oninput="updateCurrentScout()"></textarea></div>
      <button class="action-button" onclick="saveScoutData(3)">完成並儲存</button>
    </div>
  </div>

  <!-- 檔案庫容器 -->
  <div id="data-container" class="data-container">
    <div class="header">檔案庫</div>
    <div id="data-list"></div>
    <div style="display: flex; gap: 10px; margin-top: 20px;">
        <button class="action-button" onclick="exportToCSV()">下載所有資料 (CSV)</button>
        <button class="action-button" onclick="clearAllData()">清空所有資料</button>
    </div>
  </div>
  
  <!-- 資料檢視彈出視窗 -->
  <div id="data-modal" class="modal">
    <div class="modal-content">
      <!-- 新增標題容器，包含標題和關閉按鈕 -->
      <div class="modal-header-container">
        <h2 class="modal-title">偵查資料詳情</h2>
        <span class="close-button" onclick="closeModal()">&times;</span>
      </div>
      <div id="modal-data-content">
        <!-- 資料將在此處動態載入 -->
      </div>
      <!-- 新增關閉按鈕在底部，並給予樣式 -->
      <button class="action-button" onclick="closeModal()" style="width: auto; margin-top: 20px;">關閉</button>
    </div>
  </div>

  <!-- 訊息與確認彈出視窗 -->
  <div id="message-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header-container">
            <h2 class="modal-title">訊息</h2>
            <span class="close-button" onclick="closeMessageModal()">&times;</span>
        </div>
        <p id="message-text" style="text-align: center; font-size: 18px; margin-bottom: 20px;"></p>
        <div style="display: flex; justify-content: center; gap: 10px;">
          <button id="message-ok-btn" class="action-button" onclick="closeMessageModal()" style="width: auto; padding: 12px 24px;">確認</button>
          <button id="message-cancel-btn" class="action-button" onclick="closeMessageModal()" style="width: auto; padding: 12px 24px; display:none; background-color: #6c757d;">取消</button>
        </div>
      </div>
  </div>

  <script>
    // 儲存所有已偵查資料的陣列
    let scoutingData = [];
    // 儲存當前正在偵查的資料
    let currentScout = {};
    let currentTeam = 1;
    // 儲存確認視窗的回呼函數
    let confirmationCallback = null;

    /**
     * 從 localStorage 載入數據
     */
    function loadData() {
      try {
        const storedData = localStorage.getItem('scoutingData');
        if (storedData) {
          scoutingData = JSON.parse(storedData);
        }
        renderDataList();
      } catch (e) {
        console.error("無法從 localStorage 載入數據:", e);
        scoutingData = [];
      }
    }
    
    /**
     * 將當前偵查數據同步到 currentScout 物件中
     */
    function updateCurrentScout() {
        const teamId = currentTeam;
        currentScout.matchInfo = {
            scoutName: document.getElementById('scout-name-' + teamId)?.value || '',
            teamNumber: document.getElementById('team-number-' + teamId)?.value || '',
            matchType: document.getElementById('match-type-' + teamId)?.value || '',
            matchNumber: document.getElementById('match-number-' + teamId)?.value || ''
        };
        currentScout.auto = {
            leaveStartingLine: document.getElementById('auto_leave-starting-line-' + teamId)?.checked || false,
            'coral-l1': parseInt(document.getElementById('auto_coral-l1-score-' + teamId)?.textContent) || 0,
            'coral-l2': parseInt(document.getElementById('auto_coral-l2-score-' + teamId)?.textContent) || 0,
            'coral-l3': parseInt(document.getElementById('auto_coral-l3-score-' + teamId)?.textContent) || 0,
            'coral-l4': parseInt(document.getElementById('auto_coral-l4-score-' + teamId)?.textContent) || 0,
            'processor': parseInt(document.getElementById('auto_processor-score-' + teamId)?.textContent) || 0,
            'net': parseInt(document.getElementById('auto_net-score-' + teamId)?.textContent) || 0,
        };
        currentScout.teleop = {
            'coral-l1': parseInt(document.getElementById('teleop_coral-l1-score-' + teamId)?.textContent) || 0,
            'coral-l2': parseInt(document.getElementById('teleop_coral-l2-score-' + teamId)?.textContent) || 0,
            'coral-l3': parseInt(document.getElementById('teleop_coral-l3-score-' + teamId)?.textContent) || 0,
            'coral-l4': parseInt(document.getElementById('teleop_coral-l4-score-' + teamId)?.textContent) || 0,
            'processor': parseInt(document.getElementById('teleop_processor-score-' + teamId)?.textContent) || 0,
            'net': parseInt(document.getElementById('teleop_net-score-' + teamId)?.textContent) || 0,
            intakeFrom: document.getElementById('teleop_intake-coral-from-' + teamId)?.value || '',
            removeAlgae: document.getElementById('teleop_remove-algae-' + teamId)?.checked || false,
        };
        currentScout.endgame = {
            bargeStatus: document.getElementById('endgame_barge-status-' + teamId)?.value || '',
            coopertition: document.getElementById('endgame_coopertition-' + teamId)?.checked || false,
            totalScore: document.getElementById('endgame_total-score-' + teamId)?.value || '',
            rankingPoints: document.getElementById('endgame_ranking-points-' + teamId)?.value || '',
            role: document.getElementById('endgame_role-' + teamId)?.value || '',
            driverSkill: document.getElementById('endgame_driver-skill-' + teamId)?.value || '',
            matchResult: document.getElementById('endgame_match-result-' + teamId)?.value || '',
            comments: document.getElementById('endgame_comments-' + teamId)?.value || '',
        };
    }
    
    /**
     * 將當前數據保存到 localStorage 並清空當前表單
     * @param {number} teamId - 隊伍編號
     */
    function saveScoutData(teamId) {
        updateCurrentScout(); // 確保資料是最新的
        if (currentScout.matchInfo.teamNumber && currentScout.matchInfo.matchNumber) {
            scoutingData.push(JSON.parse(JSON.stringify(currentScout))); // 深拷貝
            localStorage.setItem('scoutingData', JSON.stringify(scoutingData));
            showMessage('數據已儲存！');
            resetForm(teamId);
            renderDataList();
            // 切換回比賽資訊頁面
            goToPage(teamId, 'match-info');
        } else {
            showMessage('請填寫隊伍編號和比賽編號！');
        }
    }
    
    /**
     * 重設指定隊伍的表單
     * @param {number} teamId - 隊伍編號
     */
    function resetForm(teamId) {
        document.getElementById('scout-name-' + teamId).value = '';
        document.getElementById('team-number-' + teamId).value = '';
        document.getElementById('match-type-' + teamId).value = 'practice';
        document.getElementById('match-number-' + teamId).value = '';
        
        document.getElementById('auto_leave-starting-line-' + teamId).checked = false;
        
        ['auto', 'teleop'].forEach(phase => {
            document.querySelectorAll('#page-' + phase + '-' + teamId + ' .score-count').forEach(item => {
                item.textContent = 0;
            });
        });
        document.getElementById('teleop_intake-coral-from-' + teamId).value = 'coral station';
        document.getElementById('teleop_remove-algae-' + teamId).checked = false;
        
        document.getElementById('endgame_barge-status-' + teamId).value = 'did not attempt';
        document.getElementById('endgame_coopertition-' + teamId).checked = false;
        document.getElementById('endgame_total-score-' + teamId).value = '';
        document.getElementById('endgame_ranking-points-' + teamId).value = '';
        document.getElementById('endgame_role-' + teamId).value = 'coral';
        document.getElementById('endgame_driver-skill-' + teamId).value = 'great';
        document.getElementById('endgame_match-result-' + teamId).value = 'win';
        document.getElementById('endgame_comments-' + teamId).value = '';
        
        currentScout = {};
    }

    /**
     * 改變分數並同步到 currentScout
     * @param {number} teamId - 隊伍編號
     * @param {string} itemId - 計分項目的 ID (e.g., 'auto_coral-l1')
     * @param {number} amount - 增加或減少的數量
     */
    function changeScore(teamId, itemId, amount) {
      const scoreElement = document.getElementById(itemId + '-score-' + teamId);
      if (scoreElement) {
        let currentScore = parseInt(scoreElement.textContent);
        currentScore += amount;
        if (currentScore < 0) currentScore = 0;
        scoreElement.textContent = currentScore;
        updateCurrentScout();
      }
    }
    
    /**
     * 切換主要分頁 (隊伍或檔案庫)
     * @param {string} containerId - 目標容器的 ID (e.g., 'team-container-1', 'data-container')
     * @param {HTMLElement} tabElement - 被點擊的 tab 元素
     */
    function switchMainTab(containerId, tabElement) {
      document.querySelectorAll('.main-tab').forEach(tab => tab.classList.remove('active'));
      tabElement.classList.add('active');
      document.querySelectorAll('.team-container, .data-container').forEach(container => container.classList.remove('active'));
      const activeContainer = document.getElementById(containerId);
      if (activeContainer) {
        activeContainer.classList.add('active');
      }

      if (containerId.startsWith('team')) {
        currentTeam = parseInt(containerId.slice(-1));
        // 同步當前隊伍的表單數據到 currentScout
        updateCurrentScout();
      } else if (containerId === 'data-container') {
        renderDataList();
      }
    }
    
    /**
     * 切換隊伍內的頁面
     * @param {number} teamId - 隊伍編號
     * @param {string} pageId - 目標頁面的 ID (e.g., 'auto', 'teleop')
     */
    function goToPage(teamId, pageId) {
      document.querySelectorAll('#team-container-' + teamId + ' .page-tab').forEach(tab => tab.classList.remove('active'));
      const activeTab = document.getElementById('tab-page-' + pageId + '-' + teamId);
      if (activeTab) {
        activeTab.classList.add('active');
      }
      document.querySelectorAll('#team-container-' + teamId + ' .page-content').forEach(page => page.classList.remove('active'));
      const activePage = document.getElementById('page-' + pageId + '-' + teamId);
      if (activePage) {
        activePage.classList.add('active');
      }
    }

    /**
     * 渲染檔案庫中的數據列表
     */
    function renderDataList() {
      const dataList = document.getElementById('data-list');
      if (!dataList) return;
      
      dataList.innerHTML = '';
      if (scoutingData.length === 0) {
        dataList.innerHTML = '<p style="text-align: center; color: #888;">目前沒有任何偵查紀錄。</p>';
        return;
      }
      scoutingData.forEach((data, index) => {
        const item = document.createElement('div');
        item.className = 'data-item';
        // 添加點擊事件，用於顯示詳細資料
        item.onclick = () => viewScoutData(index);
        item.innerHTML = `
          <div class="data-info">
            比賽: #${data.matchInfo.matchNumber} - 隊伍: #${data.matchInfo.teamNumber}
          </div>
          <div class="data-actions">
            <button onclick="event.stopPropagation(); deleteData(${index})">刪除</button>
          </div>
        `;
        dataList.appendChild(item);
      });
    }

    /**
     * 刪除檔案庫中的單筆數據
     * @param {number} index - 要刪除的數據索引
     */
    function deleteData(index) {
        showConfirmation('確定要刪除這筆數據嗎？', () => {
            scoutingData.splice(index, 1);
            localStorage.setItem('scoutingData', JSON.stringify(scoutingData));
            renderDataList();
            showMessage('數據已刪除！');
        });
    }

    /**
     * 清空所有數據
     */
    function clearAllData() {
        showConfirmation('確定要清空所有偵查紀錄嗎？這個動作無法復原。', () => {
            scoutingData = [];
            localStorage.removeItem('scoutingData');
            renderDataList();
            showMessage('所有數據已清空！');
        });
    }

    /**
     * 顯示選定的偵查資料詳情在彈出視窗中
     * @param {number} index - 要檢視的數據索引
     */
    function viewScoutData(index) {
        const data = scoutingData[index];
        const modalContent = document.getElementById('modal-data-content');
        if (!data || !modalContent) return;

        let html = `
            <div class="modal-section">
                <div class="modal-section-header">比賽資訊</div>
                <div class="modal-data-row"><span class="modal-label">偵查員:</span> <span>${data.matchInfo.scoutName || '未提供'}</span></div>
                <div class="modal-data-row"><span class="modal-label">隊伍編號:</span> <span>${data.matchInfo.teamNumber || '未提供'}</span></div>
                <div class="modal-data-row"><span class="modal-label">比賽類型:</span> <span>${data.matchInfo.matchType || '未提供'}</span></div>
                <div class="modal-data-row"><span class="modal-label">比賽編號:</span> <span>${data.matchInfo.matchNumber || '未提供'}</span></div>
            </div>
            <div class="modal-section">
                <div class="modal-section-header">自動 (Auto)</div>
                <div class="modal-data-row"><span class="modal-label">離開起始線:</span> <span>${data.auto.leaveStartingLine ? '是' : '否'}</span></div>
                <div class="modal-data-row"><span class="modal-label">Coral L1:</span> <span>${data.auto['coral-l1'] || 0}</span></div>
                <div class="modal-data-row"><span class="modal-label">Coral L2:</span> <span>${data.auto['coral-l2'] || 0}</span></div>
                <div class="modal-data-row"><span class="modal-label">Coral L3:</span> <span>${data.auto['coral-l3'] || 0}</span></div>
                <div class="modal-data-row"><span class="modal-label">Coral L4:</span> <span>${data.auto['coral-l4'] || 0}</span></div>
                <div class="modal-data-row"><span class="modal-label">Processor:</span> <span>${data.auto.processor || 0}</span></div>
                <div class="modal-data-row"><span class="modal-label">Net:</span> <span>${data.auto.net || 0}</span></div>
            </div>
            <div class="modal-section">
                <div class="modal-section-header">遙控 (Teleop)</div>
                <div class="modal-data-row"><span class="modal-label">Coral L1:</span> <span>${data.teleop['coral-l1'] || 0}</span></div>
                <div class="modal-data-row"><span class="modal-label">Coral L2:</span> <span>${data.teleop['coral-l2'] || 0}</span></div>
                <div class="modal-data-row"><span class="modal-label">Coral L3:</span> <span>${data.teleop['coral-l3'] || 0}</span></div>
                <div class="modal-data-row"><span class="modal-label">Coral L4:</span> <span>${data.teleop['coral-l4'] || 0}</span></div>
                <div class="modal-data-row"><span class="modal-label">Processor:</span> <span>${data.teleop.processor || 0}</span></div>
                <div class="modal-data-row"><span class="modal-label">Net:</span> <span>${data.teleop.net || 0}</span></div>
                <div class="modal-data-row"><span class="modal-label">Intake Coral From:</span> <span>${data.teleop.intakeFrom || '未提供'}</span></div>
                <div class="modal-data-row"><span class="modal-label">Remove Algae:</span> <span>${data.teleop.removeAlgae ? '是' : '否'}</span></div>
            </div>
            <div class="modal-section">
                <div class="modal-section-header">決賽 (Endgame)</div>
                <div class="modal-data-row"><span class="modal-label">Barge Status:</span> <span>${data.endgame.bargeStatus || '未提供'}</span></div>
                <div class="modal-data-row"><span class="modal-label">Coopertition:</span> <span>${data.endgame.coopertition ? '是' : '否'}</span></div>
                <div class="modal-data-row"><span class="modal-label">總分:</span> <span>${data.endgame.totalScore || '未提供'}</span></div>
                <div class="modal-data-row"><span class="modal-label">排名點數:</span> <span>${data.endgame.rankingPoints || '未提供'}</span></div>
                <div class="modal-data-row"><span class="modal-label">角色:</span> <span>${data.endgame.role || '未提供'}</span></div>
                <div class="modal-data-row"><span class="modal-label">駕駛員技術:</span> <span>${data.endgame.driverSkill || '未提供'}</span></div>
                <div class="modal-data-row"><span class="modal-label">比賽結果:</span> <span>${data.endgame.matchResult || '未提供'}</span></div>
                <div class="modal-data-row"><span class="modal-label">備註:</span> <span>${data.endgame.comments || '無'}</span></div>
            </div>
        `;
        modalContent.innerHTML = html;
        document.getElementById('data-modal').style.display = 'flex';
    }

    /**
     * 關閉資料詳情彈出視窗
     */
    function closeModal() {
        document.getElementById('data-modal').style.display = 'none';
    }

    /**
     * 顯示自訂訊息彈出視窗
     * @param {string} message - 要顯示的訊息
     */
    function showMessage(message) {
      document.getElementById('message-text').textContent = message;
      document.getElementById('message-ok-btn').style.display = 'block';
      document.getElementById('message-cancel-btn').style.display = 'none';
      document.getElementById('message-modal').style.display = 'flex';
    }

    /**
     * 顯示自訂確認彈出視窗
     * @param {string} message - 要顯示的訊息
     * @param {function} onConfirm - 確認後執行的回呼函數
     */
    function showConfirmation(message, onConfirm) {
        document.getElementById('message-text').textContent = message;
        document.getElementById('message-ok-btn').style.display = 'block';
        document.getElementById('message-cancel-btn').style.display = 'block';
        
        confirmationCallback = onConfirm;
        document.getElementById('message-ok-btn').onclick = () => {
            if (confirmationCallback) {
                confirmationCallback();
            }
            closeMessageModal();
        };

        document.getElementById('message-modal').style.display = 'flex';
    }

    /**
     * 關閉訊息彈出視窗
     */
    function closeMessageModal() {
        document.getElementById('message-modal').style.display = 'none';
        confirmationCallback = null;
        document.getElementById('message-ok-btn').onclick = () => closeMessageModal(); // 重設為預設行為
    }

    /**
     * 匯出所有資料為 CSV 檔案
     */
    function exportToCSV() {
      if (scoutingData.length === 0) {
        showMessage('沒有數據可以匯出。');
        return;
      }

      let csv = "Scout Name,Team Number,Match Type,Match Number,";
      csv += "Auto Leave Starting Line,Auto Coral L1,Auto Coral L2,Auto Coral L3,Auto Coral L4,Auto Processor,Auto Net,";
      csv += "Teleop Coral L1,Teleop Coral L2,Teleop Coral L3,Teleop Coral L4,Teleop Processor,Teleop Net,Intake Coral From,Remove Algae,";
      csv += "Barge Status,Coopertition,Total Score,Ranking Points,Role,Driver Skill,Match Result,Comments\n";
      
      scoutingData.forEach(data => {
        const row = [
          `"${data.matchInfo.scoutName || ''}"`,
          data.matchInfo.teamNumber || '',
          data.matchInfo.matchType || '',
          data.matchInfo.matchNumber || '',
          
          data.auto.leaveStartingLine ? 1 : 0,
          data.auto['coral-l1'] || 0,
          data.auto['coral-l2'] || 0,
          data.auto['coral-l3'] || 0,
          data.auto['coral-l4'] || 0,
          data.auto.processor || 0,
          data.auto.net || 0,

          data.teleop['coral-l1'] || 0,
          data.teleop['coral-l2'] || 0,
          data.teleop['coral-l3'] || 0,
          data.teleop['coral-l4'] || 0,
          data.teleop.processor || 0,
          data.teleop.net || 0,
          `"${data.teleop.intakeFrom || ''}"`,
          data.teleop.removeAlgae ? 1 : 0,

          `"${data.endgame.bargeStatus || ''}"`,
          data.endgame.coopertition ? 1 : 0,
          data.endgame.totalScore || 0,
          data.endgame.rankingPoints || 0,
          `"${data.endgame.role || ''}"`,
          `"${data.endgame.driverSkill || ''}"`,
          `"${data.endgame.matchResult || ''}"`,
          `"${(data.endgame.comments || '').replace(/"/g, '""')}"`
        ];
        csv += row.join(",") + "\n";
      });

      const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
      const link = document.createElement('a');
      const url = URL.createObjectURL(blob);
      link.setAttribute('href', url);
      link.setAttribute('download', 'frc_scouting_data.csv');
      link.style.visibility = 'hidden';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    }
    
    // 頁面載入時，自動載入 localStorage 中的數據
    window.onload = loadData;
  </script>

</body>
</html>
